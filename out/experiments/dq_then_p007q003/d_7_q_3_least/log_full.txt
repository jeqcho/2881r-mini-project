torch 2.1.0
transformers 4.35.2
accelerate 0.24.1
# of gpus:  1
Disentangle: True
loading llm model llama2-7b-chat-hf
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:25<00:25, 25.83s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:34<00:00, 15.86s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:34<00:00, 17.36s/it]
use device  cuda:0
================================================================================
DQ then P007Q003 Two-Stage Pruning
Stage 1: d=7.0%, q=3.0%
Stage 2: p=7%, q=3%
================================================================================

================================================================================
DQ then P007Q003 Two-Stage Pruning
================================================================================
Stage 1: Prune BOTTOM d=7.0% (LEAST dangerous) neurons NOT in top q=3.0% utility
Stage 2: Use PRE-EXISTING safety SNIP scores, then prune p=7.0%, q=3.0%

Storage paths:
  Stage 1 model: out/experiments/dq_then_p007q003/d_7_q_3_least/stage1_model
  Stage 2 safety scores: Using pre-existing align scores (read-only)
  Stage 2 model: out/experiments/dq_then_p007q003/d_7_q_3_least/stage2_model
================================================================================

prune every linear layer

[STAGE 1] Pruning d=7.0% danger neurons NOT in q=3.0% utility...
  Stage 1 - pruning layer 0 name self_attn.q_proj
  Stage 1 - pruning layer 0 name self_attn.k_proj
  Stage 1 - pruning layer 0 name self_attn.v_proj
  Stage 1 - pruning layer 0 name self_attn.o_proj
  Stage 1 - pruning layer 0 name mlp.gate_proj
  Stage 1 - pruning layer 0 name mlp.up_proj
  Stage 1 - pruning layer 0 name mlp.down_proj
  Stage 1 - pruning layer 1 name self_attn.q_proj
  Stage 1 - pruning layer 1 name self_attn.k_proj
  Stage 1 - pruning layer 1 name self_attn.v_proj
  Stage 1 - pruning layer 1 name self_attn.o_proj
  Stage 1 - pruning layer 1 name mlp.gate_proj
  Stage 1 - pruning layer 1 name mlp.up_proj
  Stage 1 - pruning layer 1 name mlp.down_proj
  Stage 1 - pruning layer 2 name self_attn.q_proj
  Stage 1 - pruning layer 2 name self_attn.k_proj
  Stage 1 - pruning layer 2 name self_attn.v_proj
  Stage 1 - pruning layer 2 name self_attn.o_proj
  Stage 1 - pruning layer 2 name mlp.gate_proj
  Stage 1 - pruning layer 2 name mlp.up_proj
  Stage 1 - pruning layer 2 name mlp.down_proj
  Stage 1 - pruning layer 3 name self_attn.q_proj
  Stage 1 - pruning layer 3 name self_attn.k_proj
  Stage 1 - pruning layer 3 name self_attn.v_proj
  Stage 1 - pruning layer 3 name self_attn.o_proj
  Stage 1 - pruning layer 3 name mlp.gate_proj
  Stage 1 - pruning layer 3 name mlp.up_proj
  Stage 1 - pruning layer 3 name mlp.down_proj
  Stage 1 - pruning layer 4 name self_attn.q_proj
  Stage 1 - pruning layer 4 name self_attn.k_proj
  Stage 1 - pruning layer 4 name self_attn.v_proj
  Stage 1 - pruning layer 4 name self_attn.o_proj
  Stage 1 - pruning layer 4 name mlp.gate_proj
  Stage 1 - pruning layer 4 name mlp.up_proj
  Stage 1 - pruning layer 4 name mlp.down_proj
  Stage 1 - pruning layer 5 name self_attn.q_proj
  Stage 1 - pruning layer 5 name self_attn.k_proj
  Stage 1 - pruning layer 5 name self_attn.v_proj
  Stage 1 - pruning layer 5 name self_attn.o_proj
  Stage 1 - pruning layer 5 name mlp.gate_proj
  Stage 1 - pruning layer 5 name mlp.up_proj
  Stage 1 - pruning layer 5 name mlp.down_proj
  Stage 1 - pruning layer 6 name self_attn.q_proj
  Stage 1 - pruning layer 6 name self_attn.k_proj
  Stage 1 - pruning layer 6 name self_attn.v_proj
  Stage 1 - pruning layer 6 name self_attn.o_proj
  Stage 1 - pruning layer 6 name mlp.gate_proj
  Stage 1 - pruning layer 6 name mlp.up_proj
  Stage 1 - pruning layer 6 name mlp.down_proj
  Stage 1 - pruning layer 7 name self_attn.q_proj
  Stage 1 - pruning layer 7 name self_attn.k_proj
  Stage 1 - pruning layer 7 name self_attn.v_proj
  Stage 1 - pruning layer 7 name self_attn.o_proj
  Stage 1 - pruning layer 7 name mlp.gate_proj
  Stage 1 - pruning layer 7 name mlp.up_proj
  Stage 1 - pruning layer 7 name mlp.down_proj
  Stage 1 - pruning layer 8 name self_attn.q_proj
  Stage 1 - pruning layer 8 name self_attn.k_proj
  Stage 1 - pruning layer 8 name self_attn.v_proj
  Stage 1 - pruning layer 8 name self_attn.o_proj
  Stage 1 - pruning layer 8 name mlp.gate_proj
  Stage 1 - pruning layer 8 name mlp.up_proj
  Stage 1 - pruning layer 8 name mlp.down_proj
  Stage 1 - pruning layer 9 name self_attn.q_proj
  Stage 1 - pruning layer 9 name self_attn.k_proj
  Stage 1 - pruning layer 9 name self_attn.v_proj
  Stage 1 - pruning layer 9 name self_attn.o_proj
  Stage 1 - pruning layer 9 name mlp.gate_proj
  Stage 1 - pruning layer 9 name mlp.up_proj
  Stage 1 - pruning layer 9 name mlp.down_proj
  Stage 1 - pruning layer 10 name self_attn.q_proj
  Stage 1 - pruning layer 10 name self_attn.k_proj
  Stage 1 - pruning layer 10 name self_attn.v_proj
  Stage 1 - pruning layer 10 name self_attn.o_proj
  Stage 1 - pruning layer 10 name mlp.gate_proj
  Stage 1 - pruning layer 10 name mlp.up_proj
  Stage 1 - pruning layer 10 name mlp.down_proj
  Stage 1 - pruning layer 11 name self_attn.q_proj
  Stage 1 - pruning layer 11 name self_attn.k_proj
  Stage 1 - pruning layer 11 name self_attn.v_proj
  Stage 1 - pruning layer 11 name self_attn.o_proj
  Stage 1 - pruning layer 11 name mlp.gate_proj
  Stage 1 - pruning layer 11 name mlp.up_proj
  Stage 1 - pruning layer 11 name mlp.down_proj
  Stage 1 - pruning layer 12 name self_attn.q_proj
  Stage 1 - pruning layer 12 name self_attn.k_proj
  Stage 1 - pruning layer 12 name self_attn.v_proj
  Stage 1 - pruning layer 12 name self_attn.o_proj
  Stage 1 - pruning layer 12 name mlp.gate_proj
  Stage 1 - pruning layer 12 name mlp.up_proj
  Stage 1 - pruning layer 12 name mlp.down_proj
  Stage 1 - pruning layer 13 name self_attn.q_proj
  Stage 1 - pruning layer 13 name self_attn.k_proj
  Stage 1 - pruning layer 13 name self_attn.v_proj
  Stage 1 - pruning layer 13 name self_attn.o_proj
  Stage 1 - pruning layer 13 name mlp.gate_proj
  Stage 1 - pruning layer 13 name mlp.up_proj
  Stage 1 - pruning layer 13 name mlp.down_proj
  Stage 1 - pruning layer 14 name self_attn.q_proj
  Stage 1 - pruning layer 14 name self_attn.k_proj
  Stage 1 - pruning layer 14 name self_attn.v_proj
  Stage 1 - pruning layer 14 name self_attn.o_proj
  Stage 1 - pruning layer 14 name mlp.gate_proj
  Stage 1 - pruning layer 14 name mlp.up_proj
  Stage 1 - pruning layer 14 name mlp.down_proj
  Stage 1 - pruning layer 15 name self_attn.q_proj
  Stage 1 - pruning layer 15 name self_attn.k_proj
  Stage 1 - pruning layer 15 name self_attn.v_proj
  Stage 1 - pruning layer 15 name self_attn.o_proj
  Stage 1 - pruning layer 15 name mlp.gate_proj
  Stage 1 - pruning layer 15 name mlp.up_proj
  Stage 1 - pruning layer 15 name mlp.down_proj
  Stage 1 - pruning layer 16 name self_attn.q_proj
  Stage 1 - pruning layer 16 name self_attn.k_proj
  Stage 1 - pruning layer 16 name self_attn.v_proj
  Stage 1 - pruning layer 16 name self_attn.o_proj
  Stage 1 - pruning layer 16 name mlp.gate_proj
  Stage 1 - pruning layer 16 name mlp.up_proj
  Stage 1 - pruning layer 16 name mlp.down_proj
  Stage 1 - pruning layer 17 name self_attn.q_proj
  Stage 1 - pruning layer 17 name self_attn.k_proj
  Stage 1 - pruning layer 17 name self_attn.v_proj
  Stage 1 - pruning layer 17 name self_attn.o_proj
  Stage 1 - pruning layer 17 name mlp.gate_proj
  Stage 1 - pruning layer 17 name mlp.up_proj
  Stage 1 - pruning layer 17 name mlp.down_proj
  Stage 1 - pruning layer 18 name self_attn.q_proj
  Stage 1 - pruning layer 18 name self_attn.k_proj
  Stage 1 - pruning layer 18 name self_attn.v_proj
  Stage 1 - pruning layer 18 name self_attn.o_proj
  Stage 1 - pruning layer 18 name mlp.gate_proj
  Stage 1 - pruning layer 18 name mlp.up_proj
  Stage 1 - pruning layer 18 name mlp.down_proj
  Stage 1 - pruning layer 19 name self_attn.q_proj
  Stage 1 - pruning layer 19 name self_attn.k_proj
  Stage 1 - pruning layer 19 name self_attn.v_proj
  Stage 1 - pruning layer 19 name self_attn.o_proj
  Stage 1 - pruning layer 19 name mlp.gate_proj
  Stage 1 - pruning layer 19 name mlp.up_proj
  Stage 1 - pruning layer 19 name mlp.down_proj
  Stage 1 - pruning layer 20 name self_attn.q_proj
  Stage 1 - pruning layer 20 name self_attn.k_proj
  Stage 1 - pruning layer 20 name self_attn.v_proj
  Stage 1 - pruning layer 20 name self_attn.o_proj
  Stage 1 - pruning layer 20 name mlp.gate_proj
  Stage 1 - pruning layer 20 name mlp.up_proj
  Stage 1 - pruning layer 20 name mlp.down_proj
  Stage 1 - pruning layer 21 name self_attn.q_proj
  Stage 1 - pruning layer 21 name self_attn.k_proj
  Stage 1 - pruning layer 21 name self_attn.v_proj
  Stage 1 - pruning layer 21 name self_attn.o_proj
  Stage 1 - pruning layer 21 name mlp.gate_proj
  Stage 1 - pruning layer 21 name mlp.up_proj
  Stage 1 - pruning layer 21 name mlp.down_proj
  Stage 1 - pruning layer 22 name self_attn.q_proj
  Stage 1 - pruning layer 22 name self_attn.k_proj
  Stage 1 - pruning layer 22 name self_attn.v_proj
  Stage 1 - pruning layer 22 name self_attn.o_proj
  Stage 1 - pruning layer 22 name mlp.gate_proj
