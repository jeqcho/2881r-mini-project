==========================================
ActSVD Grid Search Pipeline
Started: Fri Oct 31 19:58:07 UTC 2025
==========================================

[STEP 1/4] Generating rank pairs...
------------------------------------------------
============================================================
ActSVD Rank Pair Generator (Custom Pairs)
============================================================

Loading custom rank pairs for Llama-2-7B-chat...
✓ Loaded 30 custom pairs

Configuration:
  Total pairs: 30
  r_u range: 50 to 4080
  r_s range: 4000 to 4090
  r_s values: [4000, 4090]

First 10 pairs:
   1. r_u=  50, r_s=4000
   2. r_u= 200, r_s=4000
   3. r_u= 400, r_s=4000
   4. r_u= 600, r_s=4000
   5. r_u= 800, r_s=4000
   6. r_u=1000, r_s=4000
   7. r_u=1200, r_s=4000
   8. r_u=1400, r_s=4000
   9. r_u=1600, r_s=4000
  10. r_u=1800, r_s=4000

Last 10 pairs:
  21. r_u=3950, r_s=4090
  22. r_u=4000, r_s=4090
  23. r_u=4050, r_s=4090
  24. r_u=4080, r_s=4090
  25. r_u=3450, r_s=4000
  26. r_u=3550, r_s=4000
  27. r_u=3650, r_s=4000
  28. r_u=3750, r_s=4000
  29. r_u=3850, r_s=4000
  30. r_u=3900, r_s=4000

============================================================
✓ Rank pairs saved!
============================================================

Output file: /workspace/projects/2881r-mini-project/experiments/actsvd/rank_pairs.json
Total pairs: 30

Next step: Run sweep experiments
  bash experiments/actsvd/run_actsvd_sweep.sh


✓ Rank pairs generated

[STEP 2/4] Running ActSVD sweep experiments (30 total)...
------------------------------------------------
==========================================
ActSVD Grid Search - Batch Experiment Runner
==========================================

Activating virtual environment...
Using Python: /workspace/projects/2881r-mini-project/.venv/bin/python

Loading rank pairs from: experiments/actsvd/rank_pairs.json

Total experiments to run: 30

Starting ActSVD sweep experiments...

==========================================
Experiment 1/30: r_u=50, r_s=4000
Save directory: out/experiments/actsvd_sweep/ru_0050_rs_4000
==========================================
  Results already exist, skipping...

==========================================
Experiment 2/30: r_u=200, r_s=4000
Save directory: out/experiments/actsvd_sweep/ru_0200_rs_4000
==========================================
  Results already exist, skipping...

==========================================
Experiment 3/30: r_u=400, r_s=4000
Save directory: out/experiments/actsvd_sweep/ru_0400_rs_4000
==========================================
============================================================
ActSVD Experiment: r_u=400, r_s=4000
============================================================

Configuration:
  Model: llama2-7b-chat-hf
  Utility rank (r_u): 400
  Safety rank (r_s): 4000
  Utility dataset: alpaca_cleaned_no_safety
  Safety dataset: align
  Save directory: /workspace/projects/2881r-mini-project/out/experiments/actsvd_sweep/ru_0400_rs_4000

Running command:
python /workspace/projects/2881r-mini-project/main_low_rank_diff.py --model llama2-7b-chat-hf --rank_pos 400 --rank_neg 4000 --prune_data_pos alpaca_cleaned_no_safety --prune_data_neg align --save /workspace/projects/2881r-mini-project/out/experiments/actsvd_sweep/ru_0400_rs_4000 --eval_zero_shot

Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [01:07<01:07, 67.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:31<00:00, 41.80s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:31<00:00, 45.67s/it]
loading calibdation data alpaca_cleaned_no_safety, align
dataset loading complete
making low rank:  model.layers.0.self_attn.q_proj
making low rank:  model.layers.0.self_attn.k_proj
making low rank:  model.layers.0.self_attn.v_proj
making low rank:  model.layers.0.self_attn.o_proj
making low rank:  model.layers.0.mlp.gate_proj
making low rank:  model.layers.0.mlp.up_proj
making low rank:  model.layers.0.mlp.down_proj
14.155060291290283
making low rank:  model.layers.1.self_attn.q_proj
making low rank:  model.layers.1.self_attn.k_proj
making low rank:  model.layers.1.self_attn.v_proj
making low rank:  model.layers.1.self_attn.o_proj
making low rank:  model.layers.1.mlp.gate_proj
making low rank:  model.layers.1.mlp.up_proj
making low rank:  model.layers.1.mlp.down_proj
14.155690670013428
making low rank:  model.layers.2.self_attn.q_proj
making low rank:  model.layers.2.self_attn.k_proj
making low rank:  model.layers.2.self_attn.v_proj
making low rank:  model.layers.2.self_attn.o_proj
making low rank:  model.layers.2.mlp.gate_proj
making low rank:  model.layers.2.mlp.up_proj
making low rank:  model.layers.2.mlp.down_proj
14.155690670013428
making low rank:  model.layers.3.self_attn.q_proj
making low rank:  model.layers.3.self_attn.k_proj
making low rank:  model.layers.3.self_attn.v_proj
making low rank:  model.layers.3.self_attn.o_proj
making low rank:  model.layers.3.mlp.gate_proj
making low rank:  model.layers.3.mlp.up_proj
making low rank:  model.layers.3.mlp.down_proj
14.155690670013428
making low rank:  model.layers.4.self_attn.q_proj
making low rank:  model.layers.4.self_attn.k_proj
